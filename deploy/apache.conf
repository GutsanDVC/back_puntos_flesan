<VirtualHost *:80>
    ServerName tu-dominio.com
    DocumentRoot /var/www/fastapi_app

    # Configuración de proxy
    ProxyPreserveHost On
    ProxyRequests Off
    ProxyPass /health/ http://127.0.0.1:8080/health/
    ProxyPassReverse /health/ http://127.0.0.1:8080/health/
    ProxyPass / http://127.0.0.1:8080/
    ProxyPassReverse / http://127.0.0.1:8080/

    # Configuración de logs
    ErrorLog ${APACHE_LOG_DIR}/PROJECT_NAME_error.log
    CustomLog ${APACHE_LOG_DIR}/PROJECT_NAME_access.log combined

    # Configuración de seguridad
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # Configuración de compresión
    <Location />
        SetOutputFilter DEFLATE
        SetEnvIfNoCase Request_URI \
            \.(?:gif|jpe?g|png)$ no-gzip dont-vary
        SetEnvIfNoCase Request_URI \
            \.(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary
    </Location>
</VirtualHost>

# Configuración HTTPS (descomentar cuando se configure SSL)
#<VirtualHost *:443>
#    ServerName tu-dominio.com
#    DocumentRoot /var/www/fastapi_app
#
#    SSLEngine on
#    SSLCertificateFile /etc/letsencrypt/live/tu-dominio.com/fullchain.pem
#    SSLCertificateKeyFile /etc/letsencrypt/live/tu-dominio.com/privkey.pem
#
#    # Configuración de proxy (igual que HTTP)
#    ProxyPreserveHost On
#    ProxyRequests Off
#    ProxyPass /health/ http://127.0.0.1:8080/health/
#    ProxyPassReverse /health/ http://127.0.0.1:8080/health/
#    ProxyPass / http://127.0.0.1:8080/
#    ProxyPassReverse / http://127.0.0.1:8080/
#
#    # Configuración de logs
#    ErrorLog ${APACHE_LOG_DIR}/PROJECT_NAME_ssl_error.log
#    CustomLog ${APACHE_LOG_DIR}/PROJECT_NAME_ssl_access.log combined
#
#    # Headers de seguridad adicionales para HTTPS
#    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
#</VirtualHost>
